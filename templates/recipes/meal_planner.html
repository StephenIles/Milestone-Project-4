{% extends 'recipes/base.html' %}
{% load static %}

{% block content %}
<div class="meal-planner">
    <div class="planner-header">
        <h1>Meal Planner</h1>
        <div class="planner-actions">
            <a href="{% url 'recipes:shopping_list' weekly_plan.id %}" class="btn btn-primary">
                View Shopping List
            </a>
        </div>
    </div>

    <div class="week-grid">
        {% for date, plan in daily_plans.items %}
        <div class="day-card" data-plan-id="{{ plan.id }}">
            <h3>{{ date|date:"l" }}<br>{{ date|date:"M d" }}</h3>
            
            <div class="meal-slot" data-meal-type="breakfast">
                <h4>Breakfast</h4>
                <div class="meal-content" id="breakfast-{{ plan.id }}">
                    {% if plan.breakfast %}
                        <div class="selected-recipe">
                            <span>{{ plan.breakfast.title }}</span>
                            <button onclick="removeMeal({{ plan.id }}, 'breakfast')" class="btn-remove">×</button>
                        </div>
                    {% else %}
                        <button onclick="showRecipeModal({{ plan.id }}, 'breakfast')" class="btn-add">
                            + Add Breakfast
                        </button>
                    {% endif %}
                </div>
            </div>

            <div class="meal-slot" data-meal-type="lunch">
                <h4>Lunch</h4>
                <div class="meal-content" id="lunch-{{ plan.id }}">
                    {% if plan.lunch %}
                        <div class="selected-recipe">
                            <span>{{ plan.lunch.title }}</span>
                            <button onclick="removeMeal({{ plan.id }}, 'lunch')" class="btn-remove">×</button>
                        </div>
                    {% else %}
                        <button onclick="showRecipeModal({{ plan.id }}, 'lunch')" class="btn-add">
                            + Add Lunch
                        </button>
                    {% endif %}
                </div>
            </div>

            <div class="meal-slot" data-meal-type="dinner">
                <h4>Dinner</h4>
                <div class="meal-content" id="dinner-{{ plan.id }}">
                    {% if plan.dinner %}
                        <div class="selected-recipe">
                            <span>{{ plan.dinner.title }}</span>
                            <button onclick="removeMeal({{ plan.id }}, 'dinner')" class="btn-remove">×</button>
                        </div>
                    {% else %}
                        <button onclick="showRecipeModal({{ plan.id }}, 'dinner')" class="btn-add">
                            + Add Dinner
                        </button>
                    {% endif %}
                </div>
            </div>

            <div class="notes">
                <textarea placeholder="Notes for {{ date|date:'l' }}" 
                          onchange="updateNotes({{ plan.id }}, this.value)">{{ plan.notes }}</textarea>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Recipe Selection Modal -->
<div id="recipe-modal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Select Recipe</h2>
        <div class="recipe-list">
            {% for recipe in recipes %}
            <div class="recipe-item">
                <button onclick="selectRecipe(currentPlanId, currentMealType, {{ recipe.id }})">
                    {{ recipe.title }}
                </button>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

{% csrf_token %}
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/meal_planner.css' %}">
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/meal_planner.js' %}"></script>
{% endblock %}